{% extends 'base.html' %}

{% block title %}Search • Hybrid Search Engine{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">
{% endblock %}

{% block content %}
<div class="search-page">
    <header class="search-header">
        <div class="header-right">
            <button id="settingsBtn" class="icon-btn" aria-label="Search settings">
                <i class="fas fa-sliders-h"></i>
            </button>
            <button id="clearCache" class="icon-btn" aria-label="Clear cache">
                <i class="fas fa-broom"></i>
            </button>
        </div>
    </header>

    <main class="search-main">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='images/stein.png') }}" alt="Barbie Search Engine Logo" class="logo spider-stein" onerror="this.style.display='none'">
        </div>

        <div class="search-box-container">
            <form id="searchForm" class="search-form" autocomplete="on">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input
                        id="searchInput"
                        type="text"
                        class="search-input"
                        placeholder="Search the web or your indexed content"
                        aria-label="Search query"
                        autofocus
                    >
                    <button type="button" id="clearBtn" class="clear-btn icon-btn hidden" aria-label="Clear search">
                        <i class="fas fa-times"></i>
                    </button>
                    <button type="button" id="voiceBtn" class="voice-btn icon-btn" aria-label="Voice search">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div class="tim-edit">
                     <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> </button>
                </div>
                </div>
                <div id="autocomplete" class="autocomplete hidden"></div>

                <div class="search-buttons">
                    <a href="{{ url_for('marketplace_page') }}" class="btn btn-primary" style="text-decoration: none;">
                      <i class="fas fa-shopping-cart"></i>
                      <span>Marketplace</span>
                    </a>
                    <a href="{{ url_for('jobs_page') }}" class="btn btn-primary" style="text-decoration: none;">
                        <i class="fas fa-briefcase"></i>
                        <span>Job Search</span>
                    </a>
                </div>
            </form>
        </div>

    

       <!----- <div class="gcse-search" style="display: none"></div>----->

        <section class="search-mode" aria-label="Search mode selector">
            <label for="modeButtons">Search mode</label>
            <div id="modeButtons" class="mode-buttons">
                <button type="button" class="mode-btn active" data-mode="hybrid">
                    <i class="fas fa-layer-group"></i>
                    <span>Hybrid</span>
                </button>
                <button type="button" class="mode-btn" data-mode="local">
                    <i class="fas fa-database"></i>
                    <span>Local</span>
                </button>
                <button type="button" class="mode-btn" data-mode="serpapi">
                    <i class="fas fa-globe"></i>
                    <span>Web</span>
                </button>
            </div>
        </section>

        <section>
            <div class="body">
                <div class="social-container">
                    <ul class="social-links">
                        <li class="link-item">
                            <a href="https://www.linkedin.com/" target="_self" class="social-link" id="linkedin-link">
                                <i class="fab fa-linkedin"></i>
                                <span class="link-name">LinkedIn</span>
                            </a>
                        </li>

                        <li class="link-item">
                            <a href="https://www.youtube.com/" target="_self" class="social-link" id="youtube-link">
                                <i class="fab fa-youtube"></i>
                                <span class="link-name">YouTube</span>
                            </a>
                        </li>

                        <li class="link-item">
                            <a href="https://www.facebook.com/" target="_self" class="social-link" id="facebook-link">
                                <i class="fab fa-facebook"></i>
                                <span class="link-name">Facebook</span>
                            </a>
                        </li>

                        <li class="link-item">
                            <a href="https://www.gmail.com/" target="_self" class="social-link" id="gmail-link">
                                <i class="fas fa-envelope"></i>
                                <span class="link-name">Gmail</span>
                            </a>
                        </li>

                        <li class="link-item">
                            <a href="https://www.instagram.com/" target="_self" class="social-link" id="instagram-link">
                                <i class="fab fa-instagram"></i>
                                <span class="link-name">Instagram</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="quick-stats" aria-label="Quick statistics">
            <div class="stat-item">
                <i class="fas fa-database"></i>
                <span id="indexedCount">Loading indexed content…</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-search"></i>
                <span id="searchCount">0 searches</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-chart-line"></i>
                <span id="cacheHitRate">0% cache hit</span>
            </div>
        </section>
        <div class="gcse-searchresults-only" style="display: none;"></div>
    </main>

    <footer class="search-footer">
        <div class="footer-links">
            <a href="#" onclick="return false;">About</a>
            <a href="#" onclick="return false;">Privacy</a>
            <a href="#" onclick="return false;">Terms</a>
            <a href="#" onclick="return false;">Support</a>
        </div>
        <div class="footer-info">
            Built with ❤️ for Sir Albert Einstein.
        </div>
    </footer>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal-content">
        <header class="modal-header">
            <h2 id="settingsTitle">Search Settings</h2>
            <button id="closeSettings" class="icon-btn" aria-label="Close settings">
                <i class="fas fa-times"></i>
            </button>
        </header>

        <div class="modal-body">
            <section class="setting-group">
                <h3>Search Mode</h3>
                <p>Select your preferred default mode above. Changes apply instantly.</p>
            </section>

            <section class="setting-group">
                <h3>Results Per Page</h3>
                <p>Choose how many results to display on each search results page.</p>
                <select id="maxResultsSelect" class="select-input">
                    <option value="10">10 results</option>
                    <option value="20" selected>20 results</option>
                    <option value="30">30 results</option>
                    <option value="50">50 results</option>
                    <option value="100">100 results</option>
                </select>
            </section>

            <section class="setting-group">
                <h3>Cache</h3>
                <p>Clear cached search results if you need a fresh crawl or updated ranking.</p>
                <button id="modalClearCache" class="btn btn-outline">
                    <i class="fas fa-trash-alt"></i>
                    Clear Cache
                </button>
            </section>

            <section class="setting-group">
                <h3>About</h3>
                <p>This hybrid engine blends local index results with live web results from SerpAPI when enabled.</p>
            </section>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!---<script async src="https://cse.google.com/cse.js?cx=11e9076d1c6514c16">
</script>---->
<script async src="https://cse.google.com/cse.js?cx=11e9076d1c6514c16">
</script>
<script>
    const modeButtons = document.querySelectorAll('.mode-btn');
    const googleElement = document.querySelector('.gcse-search'); 

    // Ensure the Google element is hidden initially (this is a backup to CSS/inline style)
    if (googleElement) {
        googleElement.style.display = 'none';
    }

    function switchSearchMode(selectedMode) {
        // 1. Update active button state
        modeButtons.forEach(btn => {
            if (btn.getAttribute('data-mode') === selectedMode) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });

        // 2. Control visibility of the Google search element
        if (googleElement) {
            if (selectedMode === 'google') {
                googleElement.style.display = 'block'; 
            } else {
                googleElement.style.display = 'none';
            }
        }
        
        console.log(`Switched to mode: ${selectedMode}`);
        // *** Your existing search function (in search.js) would be called here ***
        // For example: runSearch(document.getElementById('searchInput').value, selectedMode);
    }

    // Add click listeners to all mode buttons
    modeButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            // Check for the data-mode attribute on the button itself or its parent
            let mode = button.getAttribute('data-mode');
            if (!mode) {
                // In case the click hit the <a> or <i> inside, find the mode-btn parent
                mode = button.closest('.mode-btn').getAttribute('data-mode');
            }
            switchSearchMode(mode);
        });
    });

document.addEventListener('DOMContentLoaded', () => {
    const modalClear = document.getElementById('modalClearCache');
    const headerClear = document.getElementById('clearCache');
    if (modalClear && headerClear) {
        modalClear.addEventListener('click', () => headerClear.click());
    }
});
</script>
<script src="{{ url_for('static', filename='js/autocomplete.js') }}"></script>
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
{% endblock %}